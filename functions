#!/usr/bin/env bash

log() {
    echo "$(date +"[%Y-%m-%d %T,%3N]") <docker-entrypoint> $*"
}

set_java_home() {
    # hard-coded path to unpacked Zulu Java
    JAVA_HOME=/usr/lib/jvm/zulu11.62.17-ca-jdk11.0.18-linux_aarch32hf
}

instPkg() {
    for pkg in $*; do
        if [ $(dpkg-query -W -f='${Status}' "${pkg}" 2>/dev/null | grep -c "ok installed") -eq 0 ];
        then
            apt-get -qy install "${pkg}";
        fi
    done
}

# Validate that any included hotfixes have been applied
validate() (
  shopt -s nullglob
  for i in /usr/local/unifi/hotfixes/*-validate.md5sum; do
    md5sum -c "$i" > /dev/null 2>&1 || return 1
    echo "Hotfix validated: $(basename ${i::-16})"
  done
)
